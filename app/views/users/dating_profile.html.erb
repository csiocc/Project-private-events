<%= render "shared/profil_header" %>

<div class="bg-pink-50 py-12 px-6 flex flex-col items-center">
  <div class="w-full max-w-xl bg-white rounded-2xl shadow-lg border border-pink-100 p-8 space-y-8">
    <!-- Bilder-Swipe-Galerie -->
    <% if @user.photos.attached? && @user.photos.any? %>
      <div id="profile-gallery" class="relative w-full h-72 flex items-center justify-center overflow-hidden mb-6">
        <% @user.photos.each_with_index do |photo, idx| %>
          <%= image_tag photo.variant(resize_to_limit: [400, 400]), 
                class: "absolute inset-0 object-cover w-full h-full rounded-2xl transition-opacity duration-500 gallery-photo#{' hidden' unless idx == 0}" %>
        <% end %>
        <!-- Swipe Buttons -->
        <button type="button" id="prev-photo" class="absolute left-2 top-1/2 -translate-y-1/2 bg-pink-200 hover:bg-pink-300 text-pink-700 rounded-full p-2 shadow-md z-10">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
        </button>
        <button type="button" id="next-photo" class="absolute right-2 top-1/2 -translate-y-1/2 bg-pink-200 hover:bg-pink-300 text-pink-700 rounded-full p-2 shadow-md z-10">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
        </button>
      </div>
      <!-- Bild-Zähler -->
      <div class="flex justify-center gap-2 mb-2">
        <% @user.photos.each_with_index do |_, idx| %>
          <span class="inline-block w-3 h-3 rounded-full bg-pink-300 opacity-60 gallery-indicator<%= ' active' if idx == 0 %>"></span>
        <% end %>
      </div>
    <% else %>
      <div class="flex items-center justify-center h-64 bg-pink-100 rounded-2xl mb-8">
        <span class="text-5xl text-pink-300 font-extrabold"><%= @user.name.first.upcase %></span>
      </div>
    <% end %>

    <!-- Profilinfos -->
    <div class="text-center space-y-2 mb-4">
      <h1 class="text-3xl font-bold text-pink-700"><%= @user.name %></h1>
      <p class="text-gray-600 text-lg">
        <% if @user.respond_to?(:age) && @user.age.present? %>
          <%= @user.age %> Jahre
        <% end %>
        <% if @user.location.present? %>
          <span class="mx-1">·</span><%= @user.location %>
        <% end %>
      </p>
    </div>

    <!-- Profiltext -->
    <% if @user.profile_text.present? %>
      <div class="mb-4">
        <h3 class="text-pink-600 font-semibold mb-2 text-lg">Über mich</h3>
        <p class="text-gray-800 whitespace-pre-line"><%= @user.profile_text %></p>
      </div>
    <% end %>

    <!-- Gender & Präferenzen -->
    <div class="flex flex-wrap justify-center gap-6 mb-4 text-sm">
      <div class="bg-pink-100 px-4 py-2 rounded-xl text-pink-700 font-medium">
        <i class="bx bx-user"></i>
        <%= case @user.gender
              when "male" then "Männlich"
              when "female" then "Weiblich"
              when "other" then "Divers"
              else "?" end %>
      </div>
      <div class="bg-pink-100 px-4 py-2 rounded-xl text-pink-700 font-medium">
        <i class="bx bx-heart"></i>
        <%= case @user.show_gender_preferences
              when "men" then "Sucht Männer"
              when "women" then "Sucht Frauen"
              when "both" then "Sucht beides"
              else "?" end %>
      </div>
    </div>

    <!-- Follow/Unfollow Button -->
    <% if current_user != @user %>
      <div class="flex justify-center mt-6">
        <% if current_user.following?(@user) %>
          <%= button_to "Unfollow", unfollow_user_path(@user), method: :post, class: "bg-gray-100 hover:bg-gray-200 text-gray-700 px-5 py-2 rounded-xl font-medium text-base transition" %>
        <% else %>
          <%= button_to "Follow", follow_user_path(@user), method: :post, class: "bg-pink-600 hover:bg-pink-700 text-white px-5 py-2 rounded-xl font-medium text-base transition" %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<!-- Einfache JS für Swipe-Galerie (optional, ohne externe Libs) -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const photos = document.querySelectorAll(".gallery-photo");
  const indicators = document.querySelectorAll(".gallery-indicator");
  let idx = 0;
  function showPhoto(i) {
    photos.forEach((p, j) => p.style.display = (j === i) ? "" : "none");
    indicators.forEach((ind, j) => ind.style.opacity = (j === i) ? "1" : "0.6");
    idx = i;
  }
  if (photos.length > 0) showPhoto(0);
  document.getElementById("next-photo")?.addEventListener("click", () => {
    showPhoto((idx + 1) % photos.length);
  });
  document.getElementById("prev-photo")?.addEventListener("click", () => {
    showPhoto((idx - 1 + photos.length) % photos.length);
  });
});
</script>