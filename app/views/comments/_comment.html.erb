<% username = comment.user&.name.presence || "Unknown" %>

<div id="<%= dom_id(comment) %>" class="pl-2 sm:pl-4 border-l-2 border-gray-100 mt-6">
  <div class="flex items-start space-x-4">
    
    <!-- Avatar -->
    <div class="flex-shrink-0">
      <div class="w-10 h-10 flex items-center justify-center rounded-full bg-blue-100 text-blue-700 font-semibold">
        <%= username[0].upcase %>
      </div>
    </div>

    <!-- Comment Content -->
    <div class="flex-1">
      
      <!-- Header -->
      <div class="flex items-center justify-between">
        <div>
          <span class="font-medium text-gray-900"><%= username %></span>
          <span class="text-gray-400 text-sm ml-2"><%= time_ago_in_words(comment.created_at) %> ago</span>
        </div>

        <% if user_signed_in? && comment.user == current_user %>
          <div class="flex items-center space-x-2 text-sm">
            <%= link_to "Edit", edit_post_comment_path(comment.post, comment), class: "text-blue-600 hover:text-blue-800 font-medium" %>
            <%= link_to "Delete", post_comment_path(comment.post, comment),
                data: { turbo_method: :delete, turbo_confirm: "Delete this comment?" },
                class: "text-red-500 hover:text-red-700 font-medium" %>
          </div>
        <% end %>
      </div>

      <!-- Body -->
      <div class="mt-2 bg-gray-50 rounded-xl px-4 py-3 text-gray-800 leading-relaxed">
        <%= simple_format(comment.body) %>
      </div>

      <!-- Actions -->
      <div class="mt-3 flex items-center space-x-4 text-sm">
        <% if user_signed_in? %>
          <button
            type="button"
            class="text-blue-600 hover:text-blue-800 font-medium transition"
            data-action="click->comment#toggleReplyForm"
            data-comment-id="<%= comment.id %>">
            Reply
          </button>
        <% end %>
      </div>

      <!-- Reply Form (hidden until toggled) -->
      <div id="reply-form-<%= comment.id %>" class="hidden mt-4 ml-6">
        <%= render "comments/form", post: comment.post, parent: comment %>
      </div>

      <!-- Replies -->
      <% if comment.replies.any? %>
        <div class="mt-4 space-y-4 ml-6 border-l-2 border-gray-100 pl-4">
          <% comment.replies.each do |reply| %>
            <%= render "comments/comment", comment: reply %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
