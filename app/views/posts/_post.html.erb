<article id="<%= dom_id(post) %>"
  class="w-full max-w-3xl mx-auto bg-white/80 backdrop-blur-md shadow-lg border border-gray-200 rounded-xl overflow-hidden mb-10 transition-all hover:shadow-xl group"
  data-controller="collapse">

  <!-- Header: User Info & Meta -->
  <div class="flex items-center gap-4 px-6 pt-6 pb-2">
    <div class="flex-1">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-800 hover:text-blue-700 hover:underline transition">
        <%= link_to post.title, post_path(post) %>
      </h2>
      <div class="text-xs text-gray-500 flex items-center gap-2 mt-1">
        <span>by <%= post.user&.name.presence || "Unknown" %></span>
        <span>·</span>
        <span><%= time_ago_in_words(post.created_at) %> ago</span>
      </div>
    </div>
    <% if user_signed_in? && post.user == current_user %>
      <div class="flex flex-col space-y-1 items-end">
        <%= link_to "Edit", edit_post_path(post), class: "text-xs text-blue-500 hover:text-blue-700 font-medium" %>
        <%= link_to "Delete", post, data: { turbo_method: :delete, turbo_confirm: "Sicher löschen?" }, class: "text-xs text-red-500 hover:text-red-700 font-medium" %>
      </div>
    <% end %>
  </div>

  <!-- Body: Content Preview -->
  <div class="px-6 pb-3 pt-2">
    <div class="text-base sm:text-lg text-gray-700 leading-relaxed line-clamp-5">
      <%= simple_format(truncate(post.body, length: 400)) %>
    </div>
  </div>

  <!-- Interactions: Comments, Likes, Share -->
  <div class="px-6 pb-4 flex items-center gap-8 border-t border-gray-100">
    <button type="button"
      class="flex items-center gap-2 text-black hover:text-blue-800 font-medium transition"
      data-action="collapse#toggle"
      aria-expanded="false"
      aria-controls="comments_<%= post.id %>">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 8h2a2 2 0 012 2v8a2 2 0 01-2 2H7a2 2 0 01-2-2V10a2 2 0 012-2h2"></path></svg>
      <span>Comments (<%= post.comments.count %>)</span>
    </button>
    <%= button_to like_post_path(post), {
          method: :post,
          remote: true,
          class: "flex items-center gap-1 text-pink-600 hover:text-pink-800 text-sm font-medium bg-transparent border-none p-0"
        } do %>
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="..."/></svg>
      <%= turbo_frame_tag "post_#{post.id}_likes_counter" do %>
        <span><%= pluralize(post.post_likes.count, 'Like', 'Likes') %></span>
      <% end %>
    <% end %>
  </div>

  <!-- Collapsible Comments -->
  <div id="comments_<%= post.id %>"
    class="hidden px-6 pb-6 space-y-5"
    data-collapse-target="panel"
    aria-hidden="true">
    <% roots = post.comments.where(parent_id: nil).order(:created_at) %>
    <% if roots.any? %>
      <% roots.each do |comment| %>
        <%= render "comments/thread", comment: comment %>
      <% end %>
      <% if post.comments.count > 5 %>
        <div class="text-center mt-4">
          <%= link_to "View full discussion →", post_path(post), class: "text-blue-600 hover:underline text-sm font-medium" %>
        </div>
      <% end %>
    <% else %>
      <p class="text-gray-400 italic text-center py-3">No comments yet.</p>
    <% end %>
  </div>
</article>